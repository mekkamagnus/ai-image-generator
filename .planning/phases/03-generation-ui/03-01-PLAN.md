---
phase: 03-generation-ui
type: execute
domain: frontend-ui
---

<objective>
Build minimal UI for prompt input and image generation trigger.

Purpose: Create the user-facing interface that leverages the Phase 2 API integration to enable users to enter prompts and generate images.
Output: Working React UI with textarea input, generate button, and integration with useImageGeneration hook.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-qwen-integration/02-01-SUMMARY.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

**Tech stack available:**
- React 18.3.1 with TypeScript 5.6.2 (from Phase 1)
- Tailwind CSS v4 with dark mode and @theme (from Phase 1)
- PocketBase SDK 0.26.5 (from Phase 1)
- Vite 6.0.1 with HMR (from Phase 1)

**Established patterns:**
- Tailwind v4 CSS-first approach with @import "tailwindcss" and @theme in src/index.css (from Phase 1)
- Dark mode via .dark class on html element, persisted in localStorage (from Phase 1)
- Path alias @/ ‚Üí ./src for clean imports (from Phase 1)
- useImageGeneration hook for async polling workflow (from Phase 2)
- Component structure: components/ui/, components/layout/ (from Phase 1)

**Constraining decisions:**
- Phase 1: Tailwind v4 must use CSS-first approach (@import + @theme, NOT tailwind.config.js)
- Phase 1: Dark mode controlled via .dark class on html element
- Phase 2: useImageGeneration hook provides status (idle/pending/processing/succeeded/failed), imageUrl, error, and generate function
- Phase 2: Generation takes 1-2 minutes, requires loading states
- PROJECT.md: Core value is simple workflow - minimal clicks and cognitive load
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PromptInput component with textarea</name>
  <files>src/components/ui/PromptInput.tsx</files>
  <action>
Create a controlled textarea component for prompt entry:

```typescript
// src/components/ui/PromptInput.tsx
import { useState } from 'react';

interface PromptInputProps {
  value: string;
  onChange: (value: string) => void;
  onSubmit: () => void;
  disabled?: boolean;
}

export function PromptInput({ value, onChange, onSubmit, disabled }: PromptInputProps) {
  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (value.trim()) {
      onSubmit();
    }
  };

  return (
    <form onSubmit={handleSubmit} className="w-full max-w-2xl mx-auto">
      <textarea
        value={value}
        onChange={(e) => onChange(e.target.value)}
        disabled={disabled}
        placeholder="Enter your image prompt..."
        className="w-full px-4 py-3 rounded-lg bg-card border border-border text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary resize-none min-h-[120px] disabled:opacity-50 disabled:cursor-not-allowed"
        rows={4}
      />
    </form>
  );
}
```

WHY textarea over input: Image prompts can be descriptive (100-500 characters), textarea provides better UX.

WHY controlled component: Parent App.tsx needs prompt value to pass to useImageGeneration hook.

WHY disable prop: During generation, textarea should be readonly to prevent state races.

Styling follows Phase 1 patterns: bg-card, border-border, focus:ring-2 focus:ring-primary.
  </action>
  <verify>
- Component exports correctly: `import { PromptInput } from '@/components/ui/PromptInput'`
- TypeScript compiles: `npx tsc --noEmit` passes
- Component accepts value, onChange, onSubmit, disabled props
  </verify>
  <done>
PromptInput component created with controlled textarea, proper styling, and disabled state support.
</done>
</task>

<task type="auto">
  <name>Task 2: Create GenerateButton component with loading states</name>
  <files>src/components/ui/GenerateButton.tsx</files>
  <action>
Create a button component that shows different states based on generation status:

```typescript
// src/components/ui/GenerateButton.tsx
import { GenerationStatus } from '@/hooks/useImageGeneration';

interface GenerateButtonProps {
  status: GenerationStatus;
  onGenerate: () => void;
  hasPrompt: boolean;
}

export function GenerateButton({ status, onGenerate, hasPrompt }: GenerateButtonProps) {
  const getButtonText = () => {
    switch (status) {
      case 'idle':
        return 'Generate Image';
      case 'pending':
        return 'Starting...';
      case 'processing':
        return 'Generating...';
      case 'succeeded':
        return 'Generate Another';
      case 'failed':
        return 'Try Again';
      default:
        return 'Generate Image';
    }
  };

  const isDisabled = !hasPrompt || status === 'pending' || status === 'processing';

  return (
    <button
      onClick={onGenerate}
      disabled={isDisabled}
      className="w-full max-w-2xl mx-auto mt-4 px-6 py-3 rounded-lg bg-primary text-white font-semibold hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"
    >
      {status === 'processing' && (
        <svg className="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
          <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      )}
      {getButtonText()}
    </button>
  );
}
```

WHY status-based text: Provides clear feedback during 1-2 minute generation process.

WHY spinner animation: Visual indicator that async work is happening (standard pattern).

WHY disabled when no prompt: Prevents empty API calls (Phase 2 generates errors on empty prompts).

Styling matches Phase 1 button pattern: bg-primary, hover:bg-primary/90, disabled:opacity-50.
  </action>
  <verify>
- Component exports correctly: `import { GenerateButton } from '@/components/ui/GenerateButton'`
- TypeScript compiles: `npx tsc --noEmit` passes
- Component handles all 5 status states correctly
- Spinner animation renders when status === 'processing'
  </verify>
  <done>
GenerateButton component created with status-aware text, loading spinner, and disabled states.
</done>
</task>

<task type="auto">
  <name>Task 3: Integrate components with useImageGeneration in App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Replace placeholder App.tsx content with generation UI:

1. Replace entire content of src/App.tsx with:

```typescript
// src/App.tsx
import { useState, useEffect } from 'react';
import { PromptInput } from './components/ui/PromptInput';
import { GenerateButton } from './components/ui/GenerateButton';
import { useImageGeneration } from './hooks/useImageGeneration';

function App() {
  const [prompt, setPrompt] = useState('');
  const [darkMode, setDarkMode] = useState(false);
  const { generate, status, imageUrl, error, cleanup } = useImageGeneration();

  useEffect(() => {
    const isDark = localStorage.getItem('darkMode') === 'true';
    setDarkMode(isDark);
  }, []);

  const toggleDarkMode = () => {
    const newMode = !darkMode;
    setDarkMode(newMode);
    localStorage.setItem('darkMode', String(newMode));

    if (newMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  };

  const handleGenerate = () => {
    if (prompt.trim()) {
      generate(prompt, { size: '1328*1328' });
    }
  };

  const handleReset = () => {
    setPrompt('');
    cleanup();
  };

  return (
    <div className="min-h-screen bg-background text-foreground transition-colors">
      <div className="container mx-auto px-4 py-8">
        {/* Header with dark mode toggle */}
        <div className="flex justify-between items-center mb-8">
          <h1 className="text-2xl font-bold">AI Image Generator</h1>
          <button
            onClick={toggleDarkMode}
            className="px-4 py-2 rounded-lg bg-primary text-white hover:opacity-90 transition-opacity"
            aria-label="Toggle dark mode"
          >
            {darkMode ? '‚òÄÔ∏è Light' : 'üåô Dark'}
          </button>
        </div>

        {/* Main content */}
        <div className="max-w-2xl mx-auto">
          {/* Prompt input */}
          <PromptInput
            value={prompt}
            onChange={setPrompt}
            onSubmit={handleGenerate}
            disabled={status === 'pending' || status === 'processing'}
          />

          {/* Generate button */}
          <GenerateButton
            status={status}
            onGenerate={handleGenerate}
            hasPrompt={prompt.trim().length > 0}
          />

          {/* Error display */}
          {error && (
            <div className="mt-4 p-4 rounded-lg bg-destructive/10 border border-destructive text-destructive">
              <p className="font-semibold">Error:</p>
              <p className="text-sm">{error}</p>
            </div>
          )}

          {/* Status indicator */}
          {status === 'processing' && (
            <div className="mt-4 text-center text-muted-foreground">
              <p>Generating your image... This may take 1-2 minutes.</p>
              {taskId && <p className="text-xs mt-1">Task ID: {taskId}</p>}
            </div>
          )}

          {/* Image result */}
          {imageUrl && status === 'succeeded' && (
            <div className="mt-8">
              <div className="rounded-lg overflow-hidden border border-border">
                <img
                  src={imageUrl}
                  alt="Generated image"
                  className="w-full h-auto"
                />
              </div>
              <div className="mt-4 flex gap-4 justify-center">
                <a
                  href={imageUrl}
                  download="generated-image.png"
                  className="px-6 py-2 rounded-lg bg-secondary text-secondary-foreground hover:bg-secondary/80 transition-colors"
                >
                  Download Image
                </a>
                <button
                  onClick={handleReset}
                  className="px-6 py-2 rounded-lg border border-border hover:bg-muted transition-colors"
                >
                  Start Over
                </button>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

export default App;
```

2. Add taskId export to useImageGeneration hook (src/hooks/useImageGeneration.ts):
   - Change return statement to: `return { generate, status, imageUrl, taskId, error, cleanup };`

WHY replace entire App.tsx: Removes placeholder Vite/React demo content, replaces with actual app.

WHY show taskId during processing: Provides debug visibility and confirms polling is working.

WHY download button: DashScope URLs expire in 24h (Phase 2 research), users need to save images.

WHY start over button: Clears state for new generation, resets form.

WHY error display: Provides feedback when API calls fail (network errors, API key issues, etc.).
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit` passes
- Dev server runs: `npm run dev` starts successfully
- UI renders without errors: Check browser console for no errors
- All components import correctly: PromptInput, GenerateButton, useImageGeneration
- Dark mode toggle still works
- taskId is exported from useImageGeneration hook
  </verify>
  <done>
App.tsx updated with generation UI, error display, image preview, download button, and reset functionality.
</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Dev server starts: `npm run dev` runs on http://localhost:5173
- [ ] TypeScript compiles: `npx tsc --noEmit` passes with no errors
- [ ] All imports resolve: PromptInput, GenerateButton, useImageGeneration import correctly
- [ ] UI renders: Textarea, button, dark mode toggle all visible
- [ ] Button states work: Disabled when empty, shows loading spinner when processing
- [ ] Dark mode persists: Toggle survives page reload
</verification>

<success_criteria>

- PromptInput component created with textarea and controlled state
- GenerateButton component created with status-aware text and loading spinner
- App.tsx integrated with useImageGeneration hook
- Error display shows API failures
- Image preview displays generated result
- Download button enables saving images
- Dark mode toggle preserved from Phase 1
- All TypeScript compilation passes
  </success_criteria>

<output>
After completion, create `.planning/phases/03-generation-ui/03-01-SUMMARY.md`:

# Phase 3 Plan 1: Generation UI Summary

**Minimal prompt input interface with async generation workflow**

## Accomplishments

- Created PromptInput component with controlled textarea and disabled states
- Created GenerateButton component with status-aware text and loading spinner
- Integrated useImageGeneration hook from Phase 2 with App.tsx
- Added error display for API failures
- Added image preview with download button
- Added reset/start-over functionality
- Preserved dark mode toggle from Phase 1

## Files Created/Modified

- `src/components/ui/PromptInput.tsx` - Textarea component for prompt entry
- `src/components/ui/GenerateButton.tsx` - Button with status states and loading spinner
- `src/App.tsx` - Main app UI with generation workflow
- `src/hooks/useImageGeneration.ts` - Added taskId to return value

## Decisions Made

- **Textarea over text input**: Better UX for descriptive prompts (100-500 characters)
- **Status-based button text**: Clear feedback during 1-2 minute generation
- **Download button**: DashScope URLs expire in 24h (from Phase 2 research)
- **Error display inline**: Shows API failures immediately without breaking flow
- **Start over button**: Cleans state for new generation, resets form

## Issues Encountered

None anticipated - following established React/Tailwind patterns from Phase 1.

## Next Step

Ready for Phase 4: Image Display (enhanced viewing, download management)
</output>
