---
phase: 06-polish
type: execute
---

<objective>
Polish the AI Image Generator UI with enhanced loading states, responsive refinements, and accessibility improvements.

Purpose: Improve user experience through better visual feedback, mobile optimization, and accessibility compliance.
Output: Refined UI with professional polish, WCAG AA compliance, and enhanced mobile experience.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Auto-selected based on dependency graph (from frontmatter):
@.planning/phases/03-generation-ui/03-01-SUMMARY.md
@.planning/phases/05-error-handling/05-01-SUMMARY.md
@.planning/phases/5.1-add-tdd-testing-including-ui-testing-with-playwright/5.1-03-SUMMARY.md

# Key files from frontmatter (relevant to this phase):
@src/App.tsx
@src/components/ui/PromptInput.tsx
@src/components/ui/GenerateButton.tsx
@src/hooks/useImageGeneration.ts

**Tech stack available:** React 19, TypeScript, Tailwind CSS v4, Vitest, Playwright
**Established patterns:**
- Controlled component pattern for form inputs
- Status-based UI rendering (idle/pending/processing/succeeded/failed)
- Tailwind utility classes for responsive design (max-w-2xl, container mx-auto)
- ARIA attributes for accessibility (aria-label on dark mode toggle)
- Error display with user-friendly messages and suggestions

**Constraining decisions:**
- Phase 3: Textarea over text input for descriptive prompts (100-500 characters)
- Phase 3: Status-based button text ("Generate Image", "Starting...", "Generating...", "Generate Another", "Try Again")
- Phase 5.1: Sequential E2E execution with single worker
- Phase 5.1: 120 second timeout for slow DashScope API

**Issues being addressed:** None

**From STATE.md:**
- Loading states already exist: "Generating your image... This may take 1-2 minutes."
- Responsive baseline: max-w-2xl container, Tailwind classes
- E2E tests cover desktop (1920x1080), tablet (768x1024), mobile (375x667)
- Dark mode with localStorage persistence exists
- Error display with user-friendly messages implemented
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance loading states with visual progress feedback</name>
  <files>src/App.tsx, src/components/ui/GenerateButton.tsx</files>
  <action>
Add visual polish to loading states:

1. **Progress indicator**: Add an animated progress bar during image generation
   - Use Tailwind animated width transition: w-0 ‚Üí w-1/3 ‚Üí w-2/3 ‚Üí w-full over 5-second intervals
   - Position below "Generating your image..." text
   - Style: bg-primary/20 h-2 rounded-full overflow-hidden, with inner bg-primary h-full rounded-full transition-all duration-1000

2. **Status timeline**: Show generation steps with visual checkmarks
   - Create timeline: "Creating task" ‚Üí "Processing" ‚Üí "Fetching result"
   - Use icons: ‚è≥ (pending), ‚úÖ (complete), üîÑ (current)
   - Position below progress bar, small text-muted-foreground

3. **Estimated time**: Add time estimate to loading message
   - Display: "Generating your image... (~60s remaining)"
   - Update every 5 seconds based on elapsed time
   - Cap at "2+ minutes" if over 120s

Keep Task ID display as is (already good for debugging).
</action>
  <verify>
- Run: npm run dev
- Generate an image
- Confirm: Progress bar animates from 0% to 100%
- Confirm: Timeline shows steps with icons
- Confirm: Time estimate counts down
- Test E2E: npm run test:e2e -- tests/e2e/happy-path.spec.ts passes
</verify>
  <done>
Progress bar visible and animates smoothly during generation, timeline shows current step with appropriate icons, time estimate updates every 5 seconds, all states match actual generation progress
</done>
</task>

<task type="auto">
  <name>Task 2: Refine responsive design for mobile devices</name>
  <files>src/App.tsx, src/components/ui/PromptInput.tsx, src/components/ui/GenerateButton.tsx, src/index.css</files>
  <action>
Improve mobile experience with better spacing, touch targets, and layout:

1. **Touch-friendly buttons**: Increase minimum touch target size to 44px (WCAG AA)
   - Ensure all buttons (Generate, Download, Start Over, Try Again, Dark Mode) are h-11 or taller
   - Add min-h-[44px] to button classes if needed

2. **Mobile spacing adjustments**:
   - Reduce padding on mobile: px-4 py-6 (instead of py-8) on main container
   - Add responsive spacing: py-8 md:py-8 sm:py-6 on container div
   - Reduce heading size on mobile: text-2xl md:text-3xl on h1

3. **Textarea mobile optimization**:
   - Full width on mobile with better focus state
   - Add focus-visible ring for keyboard navigation
   - Ensure min-height on mobile: min-h-[120px] on textarea

4. **Image display mobile**:
   - Ensure max-width 100% on mobile
   - Add object-contain to prevent overflow
   - Stack buttons vertically on mobile (flex-col) vs horizontally on desktop (flex-row)

5. **Safe area support for mobile browsers**:
   - Add padding-top for notch: pt-safe-top (if supported) or pt-4
   - Add padding-bottom for home indicator: pb-safe-bottom (if supported) or pb-4

No changes needed to container max-w-2xl (already responsive).
</action>
  <verify>
- Run: npm run dev
- Open DevTools device emulator (iPhone SE 375x667)
- Test: All buttons at least 44px tall
- Test: Textarea full width with 120px min-height
- Test: Image fits viewport without overflow
- Test: Buttons stack vertically on mobile
- Test E2E: npm run test:e2e -- tests/e2e/responsive-design.spec.ts passes
</verify>
  <done>
Mobile layout optimized with 44px minimum touch targets, proper spacing for small screens, stacked buttons on mobile, no horizontal overflow, image fits viewport, safe area padding added
</done>
</task>

<task type="auto">
  <name>Task 3: Add visual polish and accessibility improvements</name>
  <files>src/App.tsx, src/components/ui/PromptInput.tsx, src/components/ui/GenerateButton.tsx</files>
  <action>
Implement WCAG AA accessibility compliance and visual refinements:

1. **Focus states**:
   - Add visible focus rings to all interactive elements using Tailwind focus-visible
   - Pattern: focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2
   - Ensure ring color contrasts with background (ring-primary for primary actions)

2. **ARIA labels and roles**:
   - Add aria-live="polite" to error display region
   - Add aria-live="polite" to status indicator region
   - Add aria-label to download link: "Download generated image"
   - Add aria-label to start over button: "Clear and start new generation"
   - Ensure all icons have aria-label or are role="img" with aria-label

3. **Keyboard navigation**:
   - Ensure Enter key triggers generation when textarea focused
   - Add Escape key to clear prompt/image
   - Ensure Tab order is logical: prompt ‚Üí generate ‚Üí download ‚Üí start over ‚Üí dark mode
   - Add :focus-visible styles (not just :focus) to distinguish mouse vs keyboard

4. **Color contrast improvements**:
   - Verify text-destructive on bg-destructive/10 meets WCAG AA (4.5:1)
   - Verify text-muted-foreground on background meets WCAG AA (4.5:1)
   - If not, adjust opacity: from /50 to /60 or /70

5. **Visual polish touches**:
   - Add subtle box-shadow to image container: shadow-lg
   - Add smooth transitions to all interactive elements: transition-all duration-200
   - Add hover scale effect to buttons: hover:scale-[1.02] active:scale-[0.98]
   - Ensure disabled buttons have opacity-50 and cursor-not-allowed

6. **Loading skeleton** (bonus if time permits):
   - Add shimmer effect to progress bar using animate-pulse
   - Add skeleton placeholder while image loads
</action>
  <verify>
- Run: npm run dev
- Keyboard navigation: Tab through all elements, confirm logical order
- Focus visible: Use Tab to navigate, confirm visible ring on all interactive elements
- Screen reader: Test with NVDA/VoiceOver (if available) or inspect ARIA attributes in DevTools
- Color contrast: Use Lighthouse accessibility audit, aim for 95+ score
- Visual: Test hover states on buttons, confirm smooth transitions
- Test E2E: All existing E2E tests still pass
</verify>
  <done>
All interactive elements have visible focus rings, ARIA labels present on all controls, keyboard navigation works with Enter/Escape shortcuts, color contrast meets WCAG AA, hover effects smooth and polished, Lighthouse accessibility score 95+, all E2E tests pass
</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Enhanced loading states with progress bar and timeline, responsive mobile optimizations, accessibility improvements with focus states and ARIA labels</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:5173
    3. Test loading states:
       - Enter prompt and click generate
       - Verify progress bar animates smoothly
       - Verify timeline shows steps with icons
       - Verify time estimate counts down
    4. Test mobile responsiveness:
       - Open DevTools device emulator (iPhone SE 375x667)
       - Verify all buttons at least 44px tall
       - Verify image fits without overflow
       - Verify buttons stack vertically
    5. Test accessibility:
       - Use Tab key to navigate - confirm visible focus rings
       - Test Enter key in textarea - confirms generation
       - Test Escape key - clears state
       - Run Lighthouse audit - verify 95+ accessibility score
    6. Test E2E:
       - Run: npm run test:e2e
       - Verify all 19 tests pass
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run test:e2e` passes all 19 tests
- [ ] Lighthouse accessibility score is 95+
- [ ] Visual polish verified across desktop, tablet, and mobile viewports
- [ ] Keyboard navigation works without mouse
- [ ] No regressions in existing functionality
</verification>

<success_criteria>

- All 3 polish tasks completed with checkpoint approval
- Progress bar and timeline enhance loading experience
- Mobile layout optimized with proper touch targets
- Accessibility compliance (WCAG AA) achieved
- All E2E tests pass with no regressions
- Lighthouse accessibility score 95+ or higher
  </success_criteria>

<output>
After completion, create `.planning/phases/06-polish/06-01-SUMMARY.md`:

# Phase 6 Plan 1: Polish Summary

**Enhanced UI with professional loading states, mobile optimization, and WCAG AA accessibility compliance**

## Accomplishments

- Animated progress bar with timeline showing generation steps
- Time estimate countdown during image generation
- Mobile-optimized layout with 44px minimum touch targets
- Stacked buttons on mobile, side-by-side on desktop
- WCAG AA accessibility with focus rings, ARIA labels, keyboard navigation
- Lighthouse accessibility score 95+
- Visual polish with smooth transitions and hover effects

## Files Created/Modified

- `src/App.tsx` - Progress bar, timeline, mobile spacing, ARIA labels, keyboard handlers
- `src/components/ui/PromptInput.tsx` - Mobile optimization, focus states
- `src/components/ui/GenerateButton.tsx` - Touch target sizing, hover effects
- `src/index.css` - Safe area padding (if added)

## Decisions Made

- **Progress bar over spinner**: Visual timeline better communicates 1-2 minute wait
- **44px touch targets**: WCAG AA requirement for mobile accessibility
- **Stacked mobile buttons**: Better UX than cramped side-by-side on small screens
- **focus-visible over focus**: Distinguishes keyboard from mouse navigation
- **Lighthouse 95+ target**: Balances accessibility with practical constraints

## Issues Encountered

None expected - all work follows established React/Tailwind patterns.

## Next Phase Readiness

Phase 6 complete. Ready for Phase 7: Deployment
- Production build configuration
- Deployment to China-compatible hosting
- China access verification
</output>
